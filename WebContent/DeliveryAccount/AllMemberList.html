<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="../jquery/jquery.twbsPagination.min.js"></script>
<script type="text/javascript" src="../jquery/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

 <script src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.min.js"></script>
</head>
<body>


<!-- 검색 -->
<div class="container" style="margin-top: 5px; margin-bottom: 10px">
<form action="" id="_frmFormSearch" method="get">

<h2>전체 회원 조회</h2>

<table class="table table-hover" style="margin-left: auto; margin-right: auto; margin-top: 3px; margin-bottom: 3px">
<tr>
	<td>검색</td>
	<td style="padding-left: 5px">
		<select id="_choice" name="choice">
			<option value="" selected="selected">회원데이터 검색</option>
			<option value="membername">회원이름</option>
			<option value="address">회원주소지</option>
			<option value="id">회원아이디</option>
		</select>
	</td>
	<td style="padding-left: 5px">
		<input type="text" id="_searchWord" name="searchWord">
	</td>
	<td style="padding-left: 5px">
		<span class="button blue">
			<button type="button" id="btnSearch">검색</button>
		</span>
	</td>
</tr>
</table>
</form>

    

<table class="table table-hover" class="list_table" id="_list_table">
<!-- <colgroup>
	<col style="width:70px">
	<col style="width:auto">
	<col style="width:100px">
</colgroup>	 -->

<tr>
	<th>회원번호</th><th>회원이름</th><th>회원아이디</th>
	<th>닉네임</th><th>주소</th><th>전화번호</th><th>생년월일</th>
	<th>회원구분</th>
</tr>

</table>
</div>
<br><br>

<div class="container">
	<nav aria-label="Page navigation">
		<ul class="pagination" id="pagination" style="justify-content:center;"></ul>
	</nav>
</div>

<br><br>


<script>

allmemberList(0);
getallmemberList();

//검색
$("#btnSearch").click(function(){
	allmemberList(0);
	getallmemberList();
});

// bbslist을 취득
function allmemberList( pNumber ) {
	
	$.ajax({
		url:"http://localhost:3000/allmemberList",
		type:"get",
		data:{ page:pNumber, choice:$("#_choice").val(), search:$("#_searchWord").val() },
		success:function( allmemberList ){
			//alert('success');
		//	alert(list);
		
	    $(".list_col").remove();
		if(allmemberList == ""){
			let app = "<tr class='list_col'>";
			app += "<td colspan='8'>회원이 없습니다.</td>";
			app += "</tr>";
			
			$("#_list_table").append(app);	
			
		}else{
			$.each(allmemberList, function (i, val) {
				
				/* 
				<th>회원번호</th><th>회원이름</th><th>회원아이디</th>
				<th>닉네임</th><th>주소</th><th>전화번호</th><th>생년월일</th>
				<th>회원구분</th> */
				
				
				
				let app = "<tr class='list_col'>"
							+ "<td>" + (i + 1) + "</td>";

					app += "<td>" +val.name + "</td>";
					app += "<td>" + val.id + "</td>";
					app += "<td>" + val.nickname + "</td>";
					app += "<td>" + val.address + "</td>";
					app += "<td>" + val.phone + "</td>";
					app += "<td>" + val.bdate + "</td>";
					if (val.memberType == 1) {
						app += "<td style='color: blue'>배달기사</td>"
					}else{
						app += "<td>일반회원</td>";	
					}
					
					app += "</tr>";
						
				$("#_list_table").append(app);	
			});	
		}//else end
		
		},
		error:function(){
			alert('error');
		}
	});
}


// 글의 총수를 취득
function getallmemberList() {
	
	$.ajax({
		url:"http://localhost:3000/getallmemberList",
		type:"get",
		data:{ page:0, choice:$("#_choice").val(), search:$("#_searchWord").val() },
		success:function( count ){
		//	alert('success');
		//	alert(count);
			loadPage(count);
		},
		error:function(){
			alert('error');
		}		
	});
}


// paging 처리
function loadPage( totalCount ) {

	let pageSize = 10;
	let nowPage = 0;
	
	let _totalPages = totalCount / pageSize;
	if(totalCount % pageSize > 0){
		_totalPages++;
	}
	
	$("#pagination").twbsPagination('destroy');	// 페이지 갱신 : 페이징을 갱신해 줘야 번호가 재설정된다.

	$("#pagination").twbsPagination({
	//	startPage: 1,
		totalPages: _totalPages,
		visiblePages: 10,
		first:'<span sria-hidden="true">«</span>',
		prev:"이전",
		next:"다음",
		last:'<span sria-hidden="true">»</span>',
		initiateStartPageClick:false,		// onPageClick 자동 실행되지 않도록 한다
		onPageClick:function(event, page){
			nowPage = page;
			//alert('nowPage:' + page);
			allmemberList( page - 1 );
		}
	});	
}


</script>
    



    

    
    
    
    
    
    
    
    
    



</body>
</html>