<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
       <title>Quixlab - Bootstrap Admin Dashboard Template by Themefisher.com</title>
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <!-- Custom Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  	<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  	
<style>

.table td {
 padding: 0px;
}
.table th {
 padding: 0px;

}
.table tr {
 padding: 0px;

}

.pagination {
  display: inline-block;
}

.pagination a {
  color: black;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
}

.pagination a.active {
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
}

.pagination a:hover:not(.active) {
  background-color: #ddd;
  border-radius: 5px;
}
</style>

<style type="text/css">
 #thNum{
	width: 200px;
	text-align: center;
}
#thQuantity{
	width: 100px;
}
#thGraph{
	width:150px;
	margin-right: 30px;
}
#thCount{
	text-align: center;
	
}
 
</style>

<style type="text/css">

.stock100{
	color: blue;
}
		  
.stock9970 {
	color: blue;
}

.stock6930{
	color: green;
}

.stock2910{
	color: green;
}

.stock10 {
	color: red;
	font-weight: 700;
}

.soldOut{
	color: red;
	font-weight: 700;
}

.tdCount{
	text-align: center;
} 
</style>

<style type="text/css">



</style>

</head>

<body>

    <!--*******************
        Preloader start
    ********************-->
    <div id="preloader">
        <div class="loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" />
            </svg>
        </div>
    </div>
    <!--*******************
        Preloader end
    ********************-->

    
    <!--**********************************
        Main wrapper start
    ***********************************-->
    <div id="main-wrapper">

        <!--**********************************
            Nav header start
        ***********************************-->
       <div class="nav-header">
            <div class="brand-logo" style="margin: 20px 20px 20px 20px">
                    <span class="logo-compact"><img src="./images/1122.png" alt=""></span>
                    <span class="brand-title" style="font-size: 24px; color:white;">MOFF</span>
            </div>
        </div>
        <!--**********************************
            Nav header end
        ***********************************-->

        <!--**********************************
            Header start
        ***********************************-->
      <div class="header">    
            <div class="header-content clearfix">
                
                <div class="nav-control">
                    <div class="hamburger">
                        <span class="toggle-icon"><i class="icon-menu"></i></span>
                    </div>
                </div>
                <div class="header-left">
                    <div class="input-group icons">
                    </div>
                </div>
            </div>
        </div>
        <!--**********************************
            Header end ti-comment-alt
        ***********************************-->

        <!--**********************************
            Sidebar start
        ***********************************-->
        <div class="nk-sidebar">           
            <div class="nk-nav-scroll">
                <ul class="metismenu" id="menu">
                    <li class="nav-label">관리자 페이지</li>
                    <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="fa fa-line-chart" style="font-size:20px"></i>&ensp;<span class="nav-text">매출관리</span>
                        </a>
                    	<ul aria-expanded="false">
                            <li><a href="newfile6.html">매출관리</a></li>
                           
                        </ul>
                    </li>
                    <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="fa fa-pencil-square-o" style="font-size:20px">&ensp;</i><span class="nav-text">주문관리</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="adminSales.html">주문관리</a></li>
                          
                        </ul>
                    </li>
                    <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="fa fa-line-chart" style="font-size:20px"></i>&ensp;<span class="nav-text">주문통계</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="adminProduct.html">주문통계</a></li>
                            <!-- <li><a href="./app-calender.html">배달승인</a></li> -->
                        </ul>
                    </li>
                    <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="fa fa-cog" style="font-size:20px">&ensp;</i><span class="nav-text">상품관리</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="adminProductWrite.html">상품등록</a></li>
                            <li><a href="adminProductList.html">상품리스트</a></li>
                            <li><a href="adminStockList.html">재고관리</a></li>
                                <li><a href="AdminAgeProduct.html">연령별 구매순위</a></li>
                            <!-- <li><a href="adminProduct.html">주문통계</a></li> -->
                        </ul>
                    </li>
                    
                    <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                           <i class="fa fa-address-book-o" style="font-size:20px"></i>&ensp;<span class="nav-text">회원관리</span>
                        </a>
                        <ul aria-expanded="false">
                            <li><a href="AdminMember.html">회원관리</a></li>
                            <!-- <li><a href="./app-calender.html">배달승인</a></li> -->
                        </ul>
                    </li>
                     <li>
                        <a class="has-arrow" href="javascript:void()" aria-expanded="false">
                            <i class="fa fa-calendar-check-o" style="font-size:20px"></i>&ensp;<span class="nav-text">배달승인</span>
                        </a>
                        <ul aria-expanded="false">
                           <li><a href="AdminBoyDATA.html">배달승인</a></li>
                            <!-- <li><a href="./app-calender.html">배달승인</a></li> -->
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
        
       
        
        <div class="content-body">
            <div class="container-fluid mt-3">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">				<!-- margin: 30px 10px 20px 50px은 위 30px, 오른쪽 10px, 아래 20px, 왼쪽 50px을 의미 -->
                            <h4 class="card-title" style="font-weight: 800; font-size:28px; margin: 30px 40px 20px 10px;">재고관리</h4>
                            	<div style="width:300px; float:right; margin-bottom: 30px;" class="input-group icons">
				        			<input type="text" class="form-control" placeholder="상품명 입력" id="_searchWord" name="searchWord"/>
				           			<button type="button" class="btn mb-1 btn-primary" id="btnSearch">검색
				            		</button>
				        		</div>
                            
                                <div class="active-member">
                                    <div class="table-responsive">
                                        <table class="table table-xs mb-0">
                                            <thead>
                                                <tr>
                                                    <th id="thNum">상품번호</th>
                                                    <th id="thName">상품명</th>
                                                    <th id="thStatus">재고상태</th>
                                                    <th id="thQuantity">수량</th>
                                                    <th id="thGraph"></th>
                                                    <th id="thCount">수량변경</th>
                                                </tr>
                                            </thead>
                                            <tbody id="stockList">
                                                <!-- <tr>
                                                    <td><img src="./images/avatar/1.jpg" class=" rounded-circle mr-3" alt="">Sarah Smith</td>
                                                    <td>iPhone X</td>
                                                    <td>
                                                        <span>United States</span>
                                                    </td>
                                                    <td>
                                                        <div>
                                                            <div class="progress" style="height: 6px">
                                                                <div class="progress-bar bg-success" style="width: 50%"></div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td><i class="fa fa-circle-o text-success  mr-2"></i> Paid</td>
                                                    <td>
                                                        <span>Last Login</span>
                                                        <span class="m-0 pl-3">10 sec ago</span>
                                                    </td>
                                                </tr> -->
                                            </tbody>
                                        </table>
                                        <div  id="stockPagination" align="center"></div>
                                    </div>
                                </div>
                            </div>
                        </div>                        
                    </div>
                
                </div>
                


            <!-- #/ container -->
        </div>
        <!--**********************************
            Content body end
        ***********************************-->
        
        
        <!--**********************************
            Footer start
        ***********************************-->
        <div class="footer">
            <div class="copyright">
                <p>Copyright &copy; Designed & Developed by <a href="https://themeforest.net/user/quixlab">Quixlab</a> 2018</p>
            </div>
        </div>
        <!--**********************************
            Footer end
        ***********************************-->
    </div>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->
    <script src="plugins/common/common.min.js"></script>
    <script src="js/custom.min.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/gleek.js"></script>
    <script src="js/styleSwitcher.js"></script>

    <!-- Chartjs -->
    <script src="./plugins/chart.js/Chart.bundle.min.js"></script>
    <!-- Circle progress -->
    <script src="./plugins/circle-progress/circle-progress.min.js"></script>
    <!-- Datamap -->
    <script src="./plugins/d3v3/index.js"></script>
    <script src="./plugins/topojson/topojson.min.js"></script>
    <script src="./plugins/datamaps/datamaps.world.min.js"></script>
    <!-- Morrisjs -->
    <script src="./plugins/raphael/raphael.min.js"></script>
    <script src="./plugins/morris/morris.min.js"></script>
    <!-- Pignose Calender -->
    <script src="./plugins/moment/moment.min.js"></script>
    <script src="./plugins/pg-calendar/js/pignose.calendar.min.js"></script>
    <!-- ChartistJS -->
    <script src="./plugins/chartist/js/chartist.min.js"></script>
    <script src="./plugins/chartist-plugin-tooltips/js/chartist-plugin-tooltip.min.js"></script>



    <script src="./js/dashboard/dashboard-1.js"></script>


<script type="text/javascript">
stockList(0);
stockListCount();

$("#btnSearch").click(function(){
	stockList(0);
	stockListCount();
});


function stockList(pagenum) {
	
	$.ajax({
		url:'http://localhost:3000/stockList',
		type:'get',
		data:{page:pagenum, search:$("#_searchWord").val()},
		success:function(list){
		//	alert('stockList succ' + JSON.stringify(list));
			
			$(".listRemove").remove();
			$.each(list, function(i, data) {
				 
				let str = "<tr class='listRemove'>";
			  str   += 		"<td style='text-align:center'>" + data.prodNum + "</td>";           
			  str 	+= 		"<td>" + data.prodName + "</td>";
			  str   += 		"<td>";
			  
			        if(data.quantity >= 100){
			  str   +=	"<span class='stock100'>재고많음</span>";
			  
			        }else if(data.quantity <= 99 && data.quantity >= 70){
			  str   +=	"<span class='stock9970'>여유</span>";     
			  
			        }else if(data.quantity <= 69 && data.quantity >= 30){
			  str   +=	"<span class='stock6930'>약간 여유</span>";      
			  
			        }else if(data.quantity <= 29 && data.quantity >= 10){
			  str   +=	"<span class='stock2910'>약간 있음</span>";
			  
			        }else if(data.quantity <= 10 && data.quantity >= 1){
			  str   +=	"<span class='stock10'><i class='fa fa-exclamation-circle' aria-hidden='true'></i>&nbsp;재고부족</span>";
			  
			        }else if(data.quantity == 0){
			  str   +=	"<span class='soldOut'><i class='fa fa-exclamation-circle' aria-hidden='true'></i>&nbsp;품절</span>";
			  
			        }
			        
			  str   += 		"</td>";
			  str	+=		"<td><span>" + data.quantity + "개</span>";
			  str   += 		"<td>";
			  
			  		if(data.quantity >= 100){
			  str   += 		 '<div class="progress" style="height: 10px">';
			  str   += 		 '<div class="progress-bar gradient-1" style="width: 100%;" role="progressbar"></div>';
			  
			  		}else if(data.quantity <= 99 && data.quantity >= 70){
  			str   += 		 '<div class="progress" style="height: 10px">';
			str   += 		 '<div class="progress-bar gradient-2" style="width: 70%;" role="progressbar"></div>';
  
			        }else if(data.quantity <= 69 && data.quantity >= 30){
        	 str   += 		 '<div class="progress" style="height: 10px">';
			 str   += 		 '<div class="progress-bar gradient-3" style="width: 50%;" role="progressbar"></div>';
  
			        }else if(data.quantity <= 29 && data.quantity >= 11){
        	 str   += 		 '<div class="progress" style="height: 10px">';
			 str   += 		 '<div class="progress-bar gradient-8" style="width: 30%;" role="progressbar"></div>';
  
			        }else if(data.quantity <= 10 && data.quantity >= 1){
        	 str   += 		 '<div class="progress" style="height: 10px">';
			 str   += 		 '<div class="progress-bar gradient-3" style="width: 10%;" role="progressbar"></div>';
  
			        }else if(data.quantity == 0){
        	 str   += 		 '<div class="progress" style="height: 10px">';
			 str   += 		 '<div class="progress-bar gradient-3" style="width: 0%;" role="progressbar"></div>';
			  
			        }
			  
			  str	+=		"</td>";
			  
			  
			  str   += 		"<td class='tdCount'>";
			  str	+=		'<input type="number" value="'+data.quantity+'" id="quantityUpdate'+i+'" min="0" style="width:80px; height:30px; text-align:center;">&emsp;';
			  str	+=		"<button class='btn mb-1 btn-rounded btn-outline-primary' onclick='stockUpdate(" + '"' + data.prodNum + '"' + ',' + '"' + i + '"' + ")'>변경</button></td>";
			  str   += 		"</tr>";
	
			    $("#stockList").append(str);
	
			});
		},
		error:function(){
			alert('stockList err');
		}
	});
}	




function stockUpdate(prodNum, i){
	let quantity = $("#quantityUpdate"+i).val();
	
	$.ajax({
		url:'http://localhost:3000/stockUpdate?prodNum=' + prodNum,
		type:'get',
		data:{prodNum:prodNum, quantity:quantity},
		success:function(data){
			if(data.trim() == "YES"){
				alert('수량이 변경되었습니다.');
				stockList();
				
			}else if(data.trim() == "NO"){
				alert('실패');
			}
		},
		error:function(){
			alert('stockUpdate err');
		}
	});
}


function stockListCount() {
	$.ajax({
	       url:"http://localhost:3000/stockListCount",
	       type:"get",
	       data:{ page:0, search:$("#_searchWord").val()},
	       success:function( pagenum ){
	     //     alert("페이지 확인:" + pagenum);
	          
	           //페이지가 아예 없지 않을시에
	    	   if(pagenum != 0 ){
					var page = "<div class='pagination' style='margin-top: 50px;'>";

					page += "<a href='#' >&laquo;</a>";
					
					//페이징 생성
					for( pageN = 0; pageN < pagenum; pageN++ ){
						if(pagenum == pageN){
							page += "<a class='active'>" + (pageN + 1) +"</a>";
						}else if(pagenum != pageN){
							page += "<a href='#;'  onclick='stockList("+ pageN +")'; return false;'> "+ (pageN + 1) + "</a>";
						}
					}//for end
					
					page += "<a href='#;' onclick='stockList("+ pageN +")'>&raquo;</a>";
					page += "</div>";
					
					$("#stockPagination").html(page);
				}//if end
	          
	          
	       },
	       error:function(){
	          alert('stockListCount error');
	       }      
	    });
}

</script>




</body>

</html>