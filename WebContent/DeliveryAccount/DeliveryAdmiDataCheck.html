<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>신청서 내역</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
 <link rel="stylesheet" href="../css/reset.css">
 <link rel="stylesheet" href="../css/signup.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
<script type="text/javascript">
let urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
    return paramPair.split(/=(.+)?/).slice(0, 2);
}).reduce(function(obj, pairArray) {
    obj[pairArray[0]] = pairArray[1];
    return obj;
}, {});
</script>

<style type="text/css">
img{
	width: 500px;
	height: 450px;

}

</style>
</head>
<body>



<div id="app" class="container" align="center">
<br>
<br>
<h1 class="summary__title_first">배달 라이더 지원서</h1>


<table class="table table-hover">



<tbody>	
</tbody>

</table>




<form method="post" id="smsForm">
 <h4 class="summary__title">라이더 결과 전송</h4>
    <ul  class="list-group">
      <li  class="list-group-item">라이더 지원자 : <input id="from" type="text" name="from"/></li>
      <li class="list-group-item">결과 입력 : <textarea id="text" name="text"></textarea></li>
      <li class="list-group-item"><input type="button" onclick="sendSMS('sendSms')" value="전송하기" /></li>
    </ul>
  </form>

  <script>
    function sendSMS(pageName){

  
    	
    	$.ajax({
    		
    		url:"http://localhost:3000/sendSms",
    		type:'post',
    		data:{'from':$("#from").val(), 'text':$("#text").val() },
    		success: function(dto) {
    			alert("success");
    			
    			
    		},
    		error:function(){
    			alert('error');
    		}
    	}); 
    	
    	
    	
    }
  </script>

</div>




<div  class="container" id="appendsignin">
<button  class="btn2" style="width: 250px" onclick = "golist()">배달기사 승인 목록</button>






</div>

<br><br>


<script type="text/javascript">
$(document).ready(function () {
	

	let memNum = urlParams.memNum;
	
	//memNum 넘어오는지 확인
	//alert("memNum:" + memNum);
	
	 $.ajax({
		
		url:"http://localhost:3000/getdeliveryman",
		type:'post',
		data:{'memNum':memNum },
		success: function(dto) {
			//alert("success");
			
			let str = "<tr>"
						+ "<th>신청자 이름</th>" 
						+ "<td><p id='deliname'>" + dto.name + "</p></td>"
						
						+ "</tr>"
						
						
						+ "<tr>"
						+ "<th>아이디</th>" 
						+ "<td>" + dto.id + "</td>"
						+ "</tr>"
						
						
						+ "<tr>"
						+ "<th>비밀번호</th>" 
						+ "<td>" + dto.pwd + "</td>"
						+ "</tr>"
						
						+ "<tr>"
						+ "<th>닉네임</th>" 
						+ "<td>" + dto.nickname + "</td>"
						+ "</tr>"
						
						+"<tr>"
						+"<th>생년월일</th>"
						+"<td>" + dto.bdate + "</td>"
						+"</tr>"
						
						+"<tr>"
						+"<th>전화번호</th>"
						+"<td>" + dto.phone + "</td>"
						+"</tr>"
						
						+"<tr>"
						+"<th>이메일주소</th>"
						+"<td>" + dto.email + "</td>"
						+"</tr>"


						+"<tr>"
						+"<th>운전면허증</th>"
						+"<td><img src='http://localhost:3000/delidata/" + dto.license +"'></td>"
						+ "</tr>"
						
						+"<tr>"
						+"<th>통장사본</th>"
						+"<td><img src='http://localhost:3000/delidata/" + dto.bank +"'></td>"
						+ "</tr>"
						
						
						
						+"<tr>"
						+"<th>화물차 사용신고 필증, 자가용 화물차 사용신고증</th>"
						+"<td><img src='http://localhost:3000/delidata/" + dto.carNum +"'></td>"
						+ "</tr>"
						
						
						
						$("tbody").append(str);	
						//alert(dto.deliveryAdmi);
			var signbtn = "<button  class='btn2' onclick = 'signin()'>승인하기</button>";			
				//승인이 안됬을떄만 버튼 표시	
				if(dto.deliveryAdmi == "" || dto.deliveryAdmi == 0){
						$("#appendsignin").append(signbtn);	
				}
				
				
			//배달 신청폼	
		},
		error:function(){
			alert('error');
		}
	}); 
	
	
});




function golist() {
	location.href="../admin/AdminMember.html";
}

function signin() {
	
	let memNum = urlParams.memNum;
	

	$.ajax({
		
		url:"http://localhost:3000/deliveryAdmi",
		type:"post",
		data:{'memNum':memNum },
		success: function(admi) {
			
			if(admi){
			
				alert("배달원으로 승인하였습니다");
				location.href="AdminMember.html";
			}else{
				alert("승인이 되지않았습니다.");
			}
		},
		error:function(){
			alert("error");
		}
		
		
		
		
		
	});//ajax end
	
}
</script>

</body>
</html>






