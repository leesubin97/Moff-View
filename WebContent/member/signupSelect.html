<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!--  naver login -->
<script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>

<!--  kakao login -->
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>	
</head>
<body>
	<button type="button" id="memberSignup">일반 회원가입</button>
	 <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
	<div style="float: left" id="naver_id_login"></div>
	<div onclick="kakaoLogin()">카카오</div>

</body>

<script type="text/javascript">

var name;
var email;
var id;

$('#memberSignup').click(function() {
	location.href = "signup.html";
});
	
	<!-- naver login 설정 -->
	var naver_id_login = new naver_id_login("E2G2Ono7tLJwqb3bgB4S", "http://localhost:8090/FinalProject/member/callback2.html");
	var state = naver_id_login.getUniqState();
	naver_id_login.setButton("green", 2, 40);
// 	naver_id_login.setDomain("YOUR_SERVICE_URL");
	naver_id_login.setState(state);
	  naver_id_login.setPopup();
	naver_id_login.init_naver_id_login();

	
	
	function onSignIn(googleUser) {
		
		 var profile = googleUser.getBasicProfile();
		 
	     console.log('Full Name: ' + profile.getName());
	     console.log("Email: " + profile.getEmail());
	     // The ID token you need to pass to your backend:
	     var id_token = googleUser.getAuthResponse().id_token;
	     console.log("ID Token: " + id_token);
	     
	     name =  profile.getName();
	     email =  profile.getEmail();
	     id = id_token.substring(0,10);
	     
	     snsCheck();
	     
	}
	
	
	window.Kakao.init("897927412ae0bc3c7301cb71197b51ba");

	function kakaoLogin() {
		window.Kakao.Auth.login({
			scope:'profile, account_email',
			success: function(authObj) {
				console.log(authObj);
				window.Kakao.API.request({
				 url: '/v2/user/me',
				    success: function(response) {
				        console.log(response);
				        console.log(response.id);
				        console.log(response.kakao_account['email']);
	                    console.log(response.properties['nickname']);
	                    
	                    
	                    id = response.id;
	                    name = response.properties['nickname'];
	                    email = response.kakao_account['email'];
	                    
	                    snsCheck();
				    },
				    fail: function(error) {
				        console.log(error);
				    }
				});
			}
		});
	}
	
	
	function snsCheck() {
		
		 
	     $.ajax({
 	  
			url:"http://localhost:3000/snsCheck",
			type:"post",
			data:{ "email":email },
			success:function( data ){
			//	alert(data);

				if(data.trim()=="YES"){ // 이메일 존재하지 않음
					// 가입
					//alert("yes");
					snsSignup();
				}else{  // 이메일 존재
					// 로그인
					//alert('no');
					alert('이미 가입된 회원입니다');
					location.href='login.html'; 
					window.close();
				}			
			},
			error:function(){
				alert("error");
			}
		});
		
	}
	
	
	function snsSignup(){

		$.ajax({
			url:"http://localhost:3000/snsSignup",
			type:"post",
			data:{ "email":email, name:name, nickname:name, id:id, pwd:id,
					address:"입력해주세요", phone:"입력해 주세요", bdate: "입력해주세요"},
			success:function( data ){
				
				if(data == ''){
					alert('login fail');
				}else{
					alert(JSON.stringify(data));
					sessionStorage.setItem("login", JSON.stringify(data));
					window.close();
					location.href = "mypage.html";

					/* opener.location.href='member/mypage.html'; 
					window.close(); */
			
				}
			},

			error:function(){
				alert("error");
			}
		});
	}


</script>
</html>