<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" type="text/css" />  
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		
        <meta http-equiv="x-ua-compatible" content="ie=edge">

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" type="image/x-icon" href="../img/favicon.ico">
        <!-- Place favicon.ico in the root directory -->
        
        <!-- Google Font -->
        <link href='https://fonts.googleapis.com/css?family=Lato:400,700,900' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>

        <!-- all css here -->
        <!-- bootstrap v3.3.6 css -->
          <link rel="stylesheet" href="../css/bootstrap.min.css">
        <!-- animate css -->
        <link rel="stylesheet" href="../css/animate.css">
        <!-- jquery-ui.min css -->
        <link rel="stylesheet" href="../css/jquery-ui.min.css">
        <!-- meanmenu css -->
        <link rel="stylesheet" href="../css/meanmenu.min.css">
        <!-- nivo-slider css -->
        <link rel="stylesheet" href="../lib/css/nivo-slider.css">
        <link rel="stylesheet" href="../lib/css/preview.css">
        <!-- slick css -->
        <link rel="stylesheet" href="../css/slick.css">
        <!-- lightbox css -->
        <link rel="stylesheet" href="../css/lightbox.min.css">
        <!-- material-design-iconic-font css -->
        <link rel="stylesheet" href="../css/material-design-iconic-font.css">
        <!-- All common css of theme -->
        <link rel="stylesheet" href="../css/taemin2.css">
        <!-- style css -->
        <link rel="stylesheet" href="../css/taemin.css">
        <!-- shortcode css -->
        <link rel="stylesheet" href="../css/shortcode.css">
        <!-- responsive css -->
        <link rel="stylesheet" href="../css/responsive.css">
        <!-- modernizr css -->
        <script src="../js/vendor/modernizr-2.8.3.min.js"></script>
        
     <!--    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css'>
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js'></script> -->
        
<style type="text/css">

.submit-button {background: #ffc929 none repeat scroll 0 0;	/* #ffa85d */}
.button-one::before {background: #FD9E39;}

.rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: center;
}
</style>

<script type="text/javascript">
let urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
    return paramPair.split(/=(.+)?/).slice(0, 2);
}).reduce(function(obj, pairArray) {
    obj[pairArray[0]] = pairArray[1];
    return obj;
}, {});
</script>


</head>
<body>


      <!-- WRAPPER START -->
        <div class="wrapper bg-white">
						<!-- BLGO-AREA START -->
			<div class="blog-area blog-2 blog-details-area  pt-80 pb-80">
				<div class="container">	
					<div class="blog">
						<div class="row">
							<!-- Single-blog start -->
							<div class="col-lg-12">
								<div class="single-blog mb-30" style="border: 1px solid #c3c3c3;">
									<div class="blog-info blog-details-info">
										<!-- <div style="height: 80px;"><h3 align="center">리뷰작성</h3></div> -->
											
												<div id="productInfo">
												
													<div style="margin-bottom: 140px;">
														<hr  style="color: gray;"/>
								                        <div style="width:800px; margin-left:140px;" align="center">
								                            <div class="modal-body">
								                                <div class="modal-product">
								                                	
								                                    <div class="product-images">
								                                        <div class="main-image images" id="productImg">
								                                           <!--  <img alt="#" src="img/product/quickview-photo.jpg"/> -->
								                                        </div>
								                                    </div><!-- .product-images -->
								
								                                    <div class="product-info">
								                                    	<div id="productName"></div>
								                                       <!--  <h1>Aenean eu tristique</h1> -->
								                                        <div class="price-box-3">
								                                            <hr />
								                                            <div class="s-price-box">
								                                            <div id="productPrice"></div>
								                                               <!--  <span class="new-price">$160.00</span>
								                                                <span class="old-price">$190.00</span> -->
								                                            </div>
								                                            <hr />
								                                        </div>
								                                        <div class="quick-desc">
								                                        	<div id="prdInfo"></div>
								                                        </div>
								                                    </div><!-- .product-info -->
								                                </div><!-- .modal-product -->
								                            </div><!-- .modal-body -->
								                        </div><!-- .modal-content -->
								                        <hr />
			                    					</div>	
			                    					
												</div>		
											<form id="reviewForm">
												<div style="margin-bottom: 80px;">
													<h3 align="center">상품은 만족하셨나요?</h3>
													<div id="writingId"></div>
														<input type="hidden" id="id" name="id" value="ddd"  style="width: 500px; background:#f6f6f6;" readonly="readonly">
														<input type="hidden" id="prodNum" name="prodNum" value="">
													</div>
													
													<div id="reviewStar">
														<div class="rating">
															<input type="radio" name="star" value="5" id="5" class="starRadio"><label for="5">☆</label> 
															<input type="radio" name="star" value="4" id="4" class="starRadio"><label for="4">☆</label> 
															<input type="radio" name="star" value="3" id="3" class="starRadio"><label for="3">☆</label> 
															<input type="radio" name="star" value="2" id="2" class="starRadio"><label for="2">☆</label> 
															<input type="radio" name="star" value="1" id="1" class="starRadio"><label for="1">☆</label>
														</div>

													</div>
													
													
													
													
													
													
												<div style="height: 200px;"></div>
												<div align="center">
													<h3 align="center">어떤 점이 좋았나요?</h3>
													<textarea rows="10px" cols="130" id="content" name="content" style="background-color: #f6f6f6; border-style: none; resize: none;"></textarea>
												</div>
												<div style="height: 20px;"></div>
												<div style="font-size: 17px;" align="center">
												<i class="zmdi zmdi-border-color"></i>&emsp;<span>리뷰작성 시 500포인트 적립!</span>
												</div>
												<div style="height: 50px;"></div>
												<div class="filebox" align="center">		
													<p style="font-size: 20px;">파일첨부</p>
													
													<input class="upload-name" value="대표사진" disabled="disabled"> 
													<label for="fileload">업로드</label>
													<input type="file" id="fileload" name="fileload" class="upload-hidden"><br>
												</div>
												
												<div style="height: 30px;"></div>
				 								<div style="font-size: 17px;" align="center">
												<i class="zmdi zmdi-camera"></i>&emsp;<span>사진 첨부 시 1,000포인트 적립!</span>
												</div>
												<div style="height: 30px;"></div>
												<div class="row">
													<div class="col-md-12" align="center">
														<button type="button" onclick="cancelReview()" data-text="취소" class="button-one submit-button mt-20" style="margin-right: 15px;">취소</button>
														<button type="button" onclick="submitReview()" data-text="등록" id="btnSubmit" class="button-one submit-button mt-20">등록</button>
													</div>
												</div>
											</form>
									</div>
								</div>
							</div>
							<!-- Single-blog end -->
						</div>
					</div>
				</div>
			</div>
			<!-- BLGO-AREA END -->	
			
			
            <!-- Writing Form End-->
            
            
		</div>

<script type="text/javascript">

let prodNum = urlParams.prodNum;
let login = JSON.parse(sessionStorage.getItem("login"));
let id = login.id;
$("#id").val(id);
$("#prodNum").val(prodNum);

getProductInfo();




$(document).ready(function(){ 
	var fileTarget = $('.filebox .upload-hidden'); 
	fileTarget.on('change', function(){ 
		// 값이 변경되면 
		if(window.FileReader){ 
			// modern browser 
			var filename = $(this)[0].files[0].name; 
		} else { 
			// old IE 
			var filename = $(this).val().split('/').pop().split('\\').pop(); 
			// 파일명만 추출 
		} // 추출한 파일명 삽입 
		$(this).siblings('.upload-name').val(filename); 
		
	}); 
	
	
});

function getProductInfo() {
	let login = JSON.parse(sessionStorage.getItem("login"));
	let id = login.id;
	let prodNum = urlParams.prodNum;
	
//	alert("아이디: " + id);
//	alert("prodNum: " + prodNum);
	
	$.ajax({
		url:'http://localhost:3000/getProductInfo?prodNum=' + prodNum,
		type:'get',
	//	data:{prodNum:prodNum},
		success:function(data){
		//	alert('getProductInfo succ');
		
		var oriexprice = String(data.oriPrice);
		var orilaprice = oriexprice.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
					
		var exprice = String(data.price);
		var laprice = exprice.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
		
		
		$("#productImg").html('<img style="width:350px; height:350px;" src="../image/' +data.filename + '">');
        $("#productName").html('<h1>' + data.prodName + '</h1>');
       
			if(data.price == null || data.price == "" ){
				$("#productPrice").html('<span class="new-price">₩' + orilaprice +'원</span>');
				
			}else{
				$("#productPrice").html('<span class="new-price">₩' + laprice +'원</span>'+'&emsp;&emsp;&emsp;&emsp;'+'<span class="old-price">₩' + orilaprice +'원</span>');
				
			}
		
		$("#prdInfo").html('<p>' + data.info + '</p>');	
			
			
			
		},
		error:function(){
			alert('getProductInfo err');
		}
		
		
	});

	


	
}




function submitReview() {
	
	var form = $("#reviewForm")[0];
	var formdata = new FormData(form);
	
	let prodNum = urlParams.prodNum;
	
	if ($('#content').val()=="" ){
        alert('내용을 기입해주세요.');
        return;                        
    }
    
    if($("input:radio[name=star]").is(":checked") == true) {
    	
    	$.ajax({
    		url:"http://localhost:3000/writeReview?prodNum=" + prodNum,
    		type:"post",
    		data:formdata,
    		enctype:'multipart/form-data',
    		processData:false,
    		contentType:false,
    		cache:false,
    		success:function(data){
    			if(data.trim() == "YES"){
    				alert('리뷰가 작성되었습니다.');
    				location.href = "../member/purchases.html";
    				
    			}else if(data.trim() == "NO"){
    				alert('실패');
    			}
    		},
    		error:function(){
    			alert("writeCommu err");
    		}
    	});
    	
    }else{
    	alert('별점을 체크해주세요.');
    	return;
    }	
	

}

		
function cancelWriting() {
	location.href = "../member/purchases.html";
}	
	
	 
	 </script>
	 
	 <script src="../js/vendor/jquery-1.12.0.min.js"></script>
     <!-- bootstrap js -->
     <script src="../js/bootstrap.min.js"></script>
     <!-- jquery.meanmenu js -->
     <script src="../js/jquery.meanmenu.js"></script>
     <!-- slick.min js -->
     <script src="../js/slick.min.js"></script>
     <!-- jquery.treeview js -->
     <script src="../js/jquery.treeview.js"></script>
     <!-- lightbox.min js -->
     <script src="../js/lightbox.min.js"></script>
     <!-- jquery-ui js -->
     <script src="../js/jquery-ui.min.js"></script>
     <!-- jquery.nivo.slider js -->
     <script src="../lib/js/jquery.nivo.slider.js"></script>
     <script src="../lib/home.js"></script>
     <!-- jquery.nicescroll.min js -->
     <script src="../js/jquery.nicescroll.min.js"></script>
     <!-- countdon.min js -->
     <script src="../js/countdon.min.js"></script>
     <!-- wow js -->
     <script src="../js/wow.min.js"></script>
     <!-- plugins js -->
     <script src="../js/plugins.js"></script>
     <!-- main js -->
     <script src="../js/main.js"></script>


</body>
</html>