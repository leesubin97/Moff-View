<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="../jquery/jquery.twbsPagination.min.js"></script>
<script type="text/javascript" src="../jquery/jquery.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

 <script src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.min.js"></script>
</head>
<body>


<!-- 검색 -->



<div>


<div class="container" style="margin-top: 5px; margin-bottom: 10px">



<form action="" id="_frmFormSearch" method="get">

<h2>배달기사 승인관리</h2>


<br>

<!-- <button  class="btn btn-info" onclick = "golist()">승인 목록</button>

<button  class="btn btn-info" onclick = "golist()">미승인 목록</button>
 -->
<br>
<table class="table table-hover" style="margin-left: auto; margin-right: auto; margin-top: 3px; margin-bottom: 3px">
<tr>
	<td>검색</td>
	<td style="padding-left: 5px">
		<select id="_choice" name="choice">
			<option value="" selected="selected">신청자검색</option>
			<option value="membername">배달원이름</option>
			<option value="address">배달원주소지</option>
			<option value="id">배달원아이디</option>
		</select>
	</td>
	<td style="padding-left: 5px">
		<input type="text" id="_searchWord" name="searchWord">
	</td>
	<td style="padding-left: 5px">
		<span class="button blue">
			<button type="button" id="btnSearch">검색</button>
		</span>
	</td>
</tr>
</table>
</form>

<table class="table table-hover" class="list_table" id="_list_table">
<!-- <colgroup>
	<col style="width:70px">
	<col style="width:auto">
	<col style="width:100px">
</colgroup>	 -->

<tr>
	<th>신청번호</th><th>신청자</th><th>주소</th><th>전화번호</th><th>생년월일</th>
	<th>승인여부</th><th>제출자료확인</th>
</tr>

</table>
</div>
<br><br>

<div class="container">
	<nav aria-label="Page navigation">
		<ul class="pagination" id="pagination" style="justify-content:center;"></ul>
	</nav>
</div>

<br><br>
</div>


<script>

deliverymanList(0);
deliveryman();

//검색
$("#btnSearch").click(function(){
	deliverymanList(0);
	deliveryman();
});

// bbslist을 취득
function deliverymanList( pNumber ) {
	
	$.ajax({
		url:"http://localhost:3000/deliverymanList",
		type:"get",
		data:{ page:pNumber, choice:$("#_choice").val(), search:$("#_searchWord").val() },
		success:function( deliverymanList ){
			//alert('success');
		//	alert(list);
		
	    $(".list_col").remove();
		if(deliverymanList == ""){
			let app = "<tr class='list_col'>";
			app += "<td colspan='8'>회원이 없습니다.</td>";
			app += "</tr>";
			
			$("#_list_table").append(app);	
			
		}else{
			$.each(deliverymanList, function (i, val) {
				
				/* 
					<th>신청번호</th><th>신청자</th><th>주소</th><th>전화번호</th><th>생년월일</th>
					<th>승인여부</th>

				*/
				//배달기사만 명단에 정리
			
				if(val.memberType == 1){
				let app = "<tr class='list_col'>"
							+ "<td>" + (i + 1) + "</td>";

					app += "<td>" + val.name + "</td>";
					app += "<td>" + val.address + "</td>";
					app += "<td>" + val.phone + "</td>";
					app += "<td>" + val.bdate + "</td>";
					if (val.deliveryAdmi == 0) {
						app += "<td style='color: red'>미승인</td>"
					}else{
						app += "<td style='color: blue'>승인</td>";	
					}
					app += "<td><a href='DeliveryAdmiDataCheck.html?memNum=" + val.memNum + "'>" +  "신청서" + "</a></td>";
					app += "</tr>";
				
						
				$("#_list_table").append(app);	
				}
			});	
		}//else end
		
		},
		error:function(){
			alert('error');
		}
	});
}


// 글의 총수를 취득
function deliveryman() {
	
	$.ajax({
		url:"http://localhost:3000/deliveryman",
		type:"get",
		data:{ page:0, choice:$("#_choice").val(), search:$("#_searchWord").val() },
		success:function( count ){
		//	alert('success');
		//	alert(count);
			loadPage(count);
		},
		error:function(){
			alert('error');
		}		
	});
}


// paging 처리
function loadPage( totalCount ) {

	let pageSize = 10;
	let nowPage = 0;
	
	let _totalPages = totalCount / pageSize;
	if(totalCount % pageSize > 0){
		_totalPages++;
	}
	
	$("#pagination").twbsPagination('destroy');	// 페이지 갱신 : 페이징을 갱신해 줘야 번호가 재설정된다.

	$("#pagination").twbsPagination({
	//	startPage: 1,
		totalPages: _totalPages,
		visiblePages: 10,
		first:'<span sria-hidden="true">«</span>',
		prev:"이전",
		next:"다음",
		last:'<span sria-hidden="true">»</span>',
		initiateStartPageClick:false,		// onPageClick 자동 실행되지 않도록 한다
		onPageClick:function(event, page){
			nowPage = page;
		//	alert('nowPage:' + page);
			deliverymanList( page - 1 );
		}
	});	
}


</script>
    



    

    
    
    
    
    
    
    
    
    



</body>
</html>